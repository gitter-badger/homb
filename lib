#!/bin/bash
#################################################################################
# homb
# 
# Reloads Homb for the calling shell. Must have $HOMBASE set! This also runs 
# handles reloading fresh as well.
#
#################################################################################
homb() {

  if [ $HOMBASE != "" ]; then

    local hombRC="${HOMBASE}/rc"

    if [ -f $hombRC ]; then

      source $hombRC

      if [ "$freshBin" != "" ]; then

        cd $HOME;
        freshtica update
        cd $OLDPWD

      else
        
        echo "WARNING: Homb uses fresh."
        echo "Do we install fresh here?"

      fi

      return 0

    else

      echo "FAIL: $hombRC (not found)"
      return 1

    fi

  else

    echo "FAIL: \$HOMBASE empty or not set."
    exit 13

  fi  

}


################################################################################
#
# hombie
#
# Checks to see that we are indeed running a shell that Homb supports.
#
################################################################################
hombie() {

  local whichBash=$(which bash 2> /dev/null)
  local aliasBash=$(alias bash 2> /dev/null)  

  case $SHELL in

    ${whichBash}|${alaisBash})
      
      return 0
      ;;
    
    *)
      return 1
      ;;

  esac
}


#################################################################################
# 
# locals_only
#
# Looks for the special file $HOMB_LOCAL and sources it.
#
#################################################################################
locals_only() {

  if [ -z "${HOMBLOCAL}" ]; then
  
    local hombrc="${HOME}/.hombrc"
  
    if [ -e "${hombrc}" ]; then 
  
      export HOMBLOCAL="${hombrc}"
  
    fi
  
  fi

  if [ -e "${HOMBLOCAL}" ]; then

    source "${HOMBLOCAL}"

  fi

}


################################################################################
# 
# include
#
# A quick way to include files for the homb project.
#
################################################################################
include() {

  if [ -f "${HOMBASE}/${1}" ];  then

    source "${HOMBASE}/${1}"

  else

    if [ -f "${HOMBASE}/${1}/rc" ]; then
      
      # Load the libraries needed for the resource file.
      # This enforces the default for $1/rc and $1/lib existing.
      if [[ ${1} != *"/"* ]]; then


        local pathLib="${HOMBASE}/${1}/lib"

        if [ -f $pathLib ]; then

          source $pathLib

        fi

        local pathAlias="${HOMBASE}/${1}/alias"

        if [ -f $pathAlias ]; then

          source $pathAlias

        fi

        local pathCompletion="${HOMBASE}/${1}/completion"

        if [ -f $pathCompletion ]; then

          source $pathCompletion

        fi

      fi

      source "${HOMBASE}/${1}/rc"

    fi
  fi
}


# Bash color test
color_test() {
        local c i j

        printf "Standard 16 colors\n"
        for ((c = 0; c < 17; c++)); do
                printf "|%s%3d%s" "$(tput setaf "$c")" "$c" "$(tput sgr0)"
        done
        printf "|\n\n"

        printf "Colors 16 to 231 for 256 colors\n"
        for ((c = 16, i = j = 0; c < 232; c++, i++)); do
                printf "|"
                ((i > 5 && (i = 0, ++j))) && printf " |"
                ((j > 5 && (j = 0, 1)))   && printf "\b \n|"
                printf "%s%3d%s" "$(tput setaf "$c")" "$c" "$(tput sgr0)"
        done
        printf "|\n\n"

        printf "Greyscale 232 to 255 for 256 colors\n"
        for ((; c < 256; c++)); do
                printf "|%s%3d%s" "$(tput setaf "$c")" "$c" "$(tput sgr0)"
        done
        printf "|\n"
}
